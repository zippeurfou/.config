#!/usr/bin/env python
import argparse
import sys
import os

# import site
# sys.path.extend(site.getsitepackages())
# Add the local library to Python path
sys.path.insert(0, os.path.expanduser("~/.local/lib"))

from pwmanager import get_password, set_password, delete_password

def create_parser():
    parser = argparse.ArgumentParser(description="Password management utility")
    subparsers = parser.add_subparsers(dest="command", required=True)

    # Get command
    get_parser = subparsers.add_parser("get", help="Get password for a service")
    get_parser.add_argument("service_name", help="Name of the service")

    # Set command
    set_parser = subparsers.add_parser("set", help="Set password for a service")
    set_parser.add_argument("service_name", help="Name of the service")
    set_parser.add_argument("password", help="Password to store")

    # Delete command
    delete_parser = subparsers.add_parser("delete", help="Delete password for a service")
    delete_parser.add_argument("service_name", help="Name of the service")

    return parser

def main():
    parser = create_parser()
    args = parser.parse_args()

    try:
        if args.command == "get":
            print(get_password(args.service_name))
        elif args.command == "set":
            set_password(args.service_name, args.password)
            print(f"Password set for {args.service_name}")
        elif args.command == "delete":
            delete_password(args.service_name)
            print(f"Password deleted for {args.service_name}")
    except Exception as e:
        print(f"Error: {str(e)}", file=sys.stderr)
        sys.exit(1)

if __name__ == "__main__":
    main()
